<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="EVengers">

<title>Which State is Adoption Fastest to Electric Vehicles – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Which State is Adoption Fastest to Electric Vehicles</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>EVengers </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="table-of-contents" class="level4">
<h4 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h4>
<ol type="1">
<li><span style="color: orange;">Introduction</span></li>
<li><span style="color: orange;">Motivations</span></li>
<li><span style="color: orange;">Data Sources</span></li>
<li><span style="color: orange;">Analysis</span></li>
<li><span style="color: orange;">Visualizations</span></li>
<li><span style="color: orange;">Relationship to Prior Work</span></li>
<li><span style="color: orange;">Potential Next Steps.</span></li>
<li><span style="color: orange;">Conclusion</span></li>
</ol>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction"><span style="color: cyan;">Introduction</span></h2>
<p>As the shift towards sustainable transportation gains momentum, identifying which U.S. states are adapting best to electric vehicles (EVs) is crucial. Our “EVengers” team has undertaken a comprehensive analysis to answer this overarching question, “Which State is adapting to electric vehicles the best?”. This exploration is driven by the broader implications for economic growth, environmental sustainability, and infrastructural development. In addition, in order to better tackle this question, our team formulated specific research questions tailored to uncover various aspects of EV adoption. They are as follows:</p>
<ul>
<li><p><a href="https://velasco23.github.io/STA9750-2024-FALL/final.html">Which States stand to benefit the most from EV adoption?</a></p></li>
<li><p><a href="https://chrismontano129.github.io/STA9750-2024-FALL/courseproject.html">How does the percentage of renewable energy in the state’s power grid correlate with EV adoption?</a></p></li>
<li><p><a href="https://mussakone.github.io/STA9750-2024-FALL/Individual-Report.html">How do the number and speed of EV charging stations in each region affect EV adoption?</a></p></li>
<li><p><a href="https://katariasiddhi.github.io/STA9750-2024-FALL/individual-report.html">What is the average cost of EV charging per region, and how does the availability of residential vs commercial charging stations correlate with the adoption rate of EVs?</a></p></li>
<li><p><a href="https://Haina0.github.io/STA9750-2024-FALL/individual_report.html">How do year-over-year EV adoption growth rates differ across states and what are the key factors influencing these trends?</a></p></li>
</ul>
</section>
<section id="motivations" class="level2">
<h2 class="anchored" data-anchor-id="motivations"><span style="color: cyan;">Motivations</span></h2>
<p>The motivations to conduct an analysis of EV adoption by state stem from both individual interests and societal needs. For individuals, the decision to adopt an electric vehicle (EV) often hinges on practical and financial considerations. High gasoline prices, rising awareness of environmental sustainability, and the desire to reduce personal carbon footprints are powerful incentives. However, the feasibility and appeal of adopting an EV vary significantly based on where one lives, influenced by factors such as electricity prices, average driving distances, and state infrastructure. This makes a state-specific analysis crucial for understanding the practicalities of widespread EV adoption.</p>
<p>From a state perspective, the motivations for encouraging EV adoption are equally compelling. States with high average mileage have an opportunity to significantly cut transportation-related greenhouse gas emissions by transitioning to EVs. Similarly, air quality concerns drive motivations in urbanized and industrial regions. States plagued by smog and pollution, view EV adoption as a critical strategy for improving public health and meeting clean air standards. States with lower electricity costs can provide EV owners with substantial savings compared to gasoline-powered vehicles.</p>
<p>Analyzing these motivations is vital for society as a whole. Transportation accounts for nearly 30% of global greenhouse gas emissions, and understanding state-specific factors can help policymakers design targeted strategies to promote EV adoption. This benefits society by improving air quality, reducing health care costs linked to pollution, and contributing to global efforts to combat climate change. Furthermore, widespread EV adoption reduces reliance on volatile oil markets and creates opportunities for economic growth through renewable energy integration. By identifying the states most poised to benefit, analyses like this can help prioritize investments and accelerate the transition to a sustainable transportation future.</p>
</section>
<section id="sata-sources" class="level2">
<h2 class="anchored" data-anchor-id="sata-sources"><span style="color: cyan;">Sata Sources</span></h2>
<p>Alternative Fueling Station Locator:</p>
<ul>
<li><p>Source: U.S. Department of Energy’s Alternative Fuels Data Center (AFDC)</p></li>
<li><p>Description/Usage: Analyze the number and distribution of charging stations per state, assess charging speeds (Level 1, Level 2, DC Fast Charging), and visualize geographic coverage.</p></li>
<li><p>Limitations: Data timeliness due to updates, Data completeness for every existing charging station.</p></li>
</ul>
<p>U.S. Census Data:</p>
<ul>
<li><p>Source: U.S. Census Bureau</p></li>
<li><p>Description/Usage: Provides population and geographic data, including population density and urban-rural classifications.</p></li>
<li><p>Limitations: Geographical Detail due to granularity of data being limited because of privacy concerns. Data suppression to protect individual privacy can lead to missing data as well.</p></li>
</ul>
<p>EIA - Power Generation</p>
<ul>
<li><p>Source: U.S. Energy Information Administration</p></li>
<li><p>Description/Usage: This data set provides comprehensive information on electricity generation in the U.S.</p></li>
<li><p>Limitations: Updated on a monthly basis, real time data would not be possible to obtain.</p></li>
</ul>
<p>EPA - Air Quality</p>
<ul>
<li><p>Source: U.S. Environmental Protection Agency</p></li>
<li><p>Description/Usage: This data set provides daily and historical air quality measurements across the United States, captured through the Air Quality Index (AQI).</p></li>
<li><p>Limitations: rapid fluctuations in pollutant concentrations might not be fully captured, which can limit the utility of data in assessing short-term exposure risks.</p></li>
</ul>
<p>State Vehicle Registration Data:</p>
<ul>
<li><p>Source: National Highway Traffic Safety Administration (NHTSA)</p></li>
<li><p>Description: Offers data on vehicle registrations, which can be filtered to focus on electric vehicles.</p></li>
<li><p>Limitations: Inconsistency in Reporting, as data collection methods and reporting standards can vary significantly from state to state, leading to potential inconsistencies in how vehicle types are classified and reported.</p></li>
</ul>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis"><span style="color: cyan;">Analysis</span></h2>
<p>The overarching goal of this analysis is to identify which state is adopting EVs the best. An important component of this question involves evaluating which state stands to benefit the most from this transition. By focusing on the potential benefits, it provides a deeper understanding of the motivations behind EV adoption. States with high average driving distances, like Georgia, stand to benefit substantially from the reduced operating costs and emissions offered by EVs. Similarly, states with air quality concerns, like California, can leverage EV adoption to address public health issues tied to pollution. Electricity prices also play a critical role, as states with low energy costs provide a stronger economic case for EV ownership compared to traditional internal combustion engine vehicles.</p>
<p>This targeted evaluation not only identifies the states that would benefit most from EV adoption but also sheds light on the challenges these states may face in achieving widespread adoption. By tying the benefits of EV adoption to state-specific conditions, this analysis supports policymakers in EV incentives and infrastructure investments to accelerate adoption.</p>
<p>The analysis of “How do the number and speed of EV charging stations in each region affect EV adoption?” helps answer the main question: “Which states are adapting to electric vehicles the best?” By researching how many charging stations each state has per person and how quickly these stations can charge a vehicle, we can see which states are best prepared for more people using electric vehicles.</p>
<p>For example, finding out that Vermont has the most charging stations per person and that California has many fast-charging stations shows that these states are leading in making it easier for people to have electric cars. This information helps us understand which states are doing well in building the right infrastructure for electric vehicles.</p>
<p>Additionally, by examining how charging stations are spread out across states and how they match up with where people live and how many electric cars are there, this analysis highlights which states are planning their resources effectively. States that have a good balance of electric cars and charging stations, especially in crowded areas, are likely adapting better to electric vehicles.</p>
<p>In simple terms, this analysis shows us which states are ready for more electric cars by looking at their charging stations and how well these meet the needs of their residents, pointing out who is leading the way in embracing electric vehicle technology.</p>
<p>Using data sourced from the National Renewable Energy Laboratory (NREL) and Experian Information Solutions, we observed notable patterns in alternative fuel vehicle (AFV) registrations. Flexible Fuel Vehicles (FFVs) and Hybrid Electric Vehicles (HEVs) dominate registration numbers, reflecting their compatibility with existing infrastructure. In contrast, niche AFVs like hydrogen fuel cells and compressed natural gas (CNG) vehicles show limited adoption due to less-developed infrastructure and higher costs.</p>
<p>Data from the U.S. Energy Information Administration revealed the rapid growth of renewable energy sources like solar and wind, which align with increased EV adoption. Solar energy exhibited exponential growth post-2010, driven by tax incentives and declining costs. Wind energy also showed remarkable growth due to technological advancements and favorable policies. These trends highlight how renewable energy supports the decarbonization of EVs by providing cleaner electricity for charging.</p>
<p>State policies and incentives significantly impact EV adoption. Programs like tax credits for EV purchases and renewable portfolio standards (RPS) directly correlate with higher EV adoption rates in states like California and New York. Localized incentives, such as rebates and exemptions for solar energy, further enhance the connection between renewable energy and EV adoption. States with extensive charging networks, such as California, lead in EV adoption. However, targeted investments in states like Texas and Florida are helping to close the gap. Public charging networks remain essential, with faster adoption observed in regions with higher infrastructure density.</p>
</section>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations"><span style="color: cyan;">Visualizations</span></h2>
<p>Using a weighted formula that incorporates air quality, average miles driven, and electricity prices, the analysis highlights states where EV adoption can yield the most significant environmental, economic, and societal advantages.</p>
<p>Formula:</p>
<p>(Air Quality Score x 34%) + (Average mileage drive x 33% ) + (Electricity prices x 33%)</p>
<p>The heat map below shows the scores of each state, we see that California, Georgia and Alabama would benefit the most from EV adoptions when these three factors are equally weighted.</p>
<p><img src="imageA.png" class="img-fluid"></p>
<p>States that generate electricity from renewable sources stand to benefit the most from EV adoption, as they provide clean energy to power vehicles that once relied on fossil fuels. Below, you can interact with this chart to explore the power generation sources of each state.</p>
<iframe src="pie_chart.html" width="100%" height="600" style="border:none;">
</iframe>
<p>While researching through data on EVs, we created maps and charts to help us visualize the data we gathered and answer our individual analyses to ultimately answer our overarching question. These visualizations allow us to compare our data and look for similarities and differences when it comes to figuring out which states are adapting to EV’s the best. The following are some of our most important findings.</p>
<p><img src="imageB.png" class="img-fluid"></p>
<p>The map illustrates the distribution of electric vehicle (EV) charging stations per capita across various states, highlighting regions with more infrastructure relative to their population.. States with higher per capita charging stations, like Vermont and California, are shown to be leaders in building infrastructure that supports the shift toward electric vehicles. This helps identify these two states as leaders when it comes to answering our overarching question.</p>
<p><img src="imageC.png" class="img-fluid"></p>
<p>This graph shows the number of Level 3 (DC Fast Charging) stations by state, illustrating a significant variation in the availability of rapid charging infrastructure across the U.S. California leads by a very large margin with the highest number of fast chargers, followed by states like Texas and Florida. This data is crucial as it highlights which states have better-developed infrastructure to support quick and efficient charging for electric vehicles, tying into our overarching question.</p>
</section>
<section id="relationship-to-prior-work" class="level2">
<h2 class="anchored" data-anchor-id="relationship-to-prior-work"><span style="color: cyan;">Relationship to Prior Work</span></h2>
<p>Our findings emphasize on the role of state policies, infrastructure, and economic factors in shaping electric vehicle adoption. Studies from organizations like the U.S. Department of Energy and the International Council on Clean Transportation have shown how incentives such as tax credits, rebates, and Zero-Emission Vehicle mandates help increase EV adoption. For example, California has been identified as a leader because of its strong ZEV mandates and generous tax incentives. This is consistent with our analysis, which highlights how California’s well-designed policies and investments in public charging infrastructure have kept it at the forefront of EV adoption. States like New York also show similar progress by leveraging similar incentives.</p>
<p>Infrastructure has always been a major focus of EV adoption studies. Research from the U.S. Department of Energy stresses that public charging networks are essential for Ev adoption growth, charging infrastructure is a significant obstacle for many EV buyers. Our findings strongly support this, showing that states with more charging stations experience faster growth in EV registrations. California, with its extensive network of charging stations, is a clear example. However, states like Texas and Florida are catching up, showing that targeted investments in infrastructure can help close the gap. To uncover more about these specific factors that were impacting EV adoption growth, a question we worked to uncover was “How do year-over-year EV adoption growth rates differ across states and what are the key factors influencing these trends?” Economic factors, like state GDP and population density, also play a big role in adoption rates. High-GDP states with dense urban areas, such as California and New York, benefit from better infrastructure and greater consumer awareness. On the other hand, low-GDP states like Oklahoma have shown rapid growth in EV adoption when supported by localized policies and incentives. This highlights the importance of flexible strategies that adapt to regional needs.</p>
</section>
<section id="potential-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="potential-next-steps"><span style="color: cyan;">Potential Next Steps</span></h2>
<p>Looking ahead, there are several opportunities for future research. One area to explore is the cultural and behavioral factors influencing EV adoption. Public perception, awareness campaigns, and societal attitudes toward sustainability could be critical drivers of future growth. Another area is the impact of new technologies. Nationwide charging networks and advancements in battery technology are already shaping the EV market, but more analysis is needed to understand their full effects. Comparing states with similar economic profiles but different levels of federal support could reveal which strategies work best for scaling adoption even on a global level. Lastly, rural and undeserved areas deserve more attention. These regions often lack charging infrastructure, making it harder for people to consider switching to EVs. By focusing on expanding infrastructure and designing policies for these areas, states can bridge the gap between urban and rural EV adoption. Long-term studies could also provide insight into how evolving policies, like phasing out incentives or increasing ZEV mandates, impact growth over time.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion"><span style="color: cyan;">Conclusion</span></h2>
<p>In conclusion, our findings indicated that California is adapting the best to EVs. This result reflects much of what prior studies have shown, while also highlighting emerging trends. By investing in infrastructure, designing adaptive policies, and considering factors like cultural attitudes and federal initiatives, states can take significant steps toward accelerating EV adoption and creating a more sustainable future.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/velasco23\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>